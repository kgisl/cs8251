<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>unit5</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#unit-v-file-processing">UNIT V FILE PROCESSING</a>
<ul>
<li></li>
<li><a href="#pre-unit-exercise---a-show-and-tell-exercise">Pre-Unit exercise - a “Show and Tell” exercise</a></li>
<li><a href="#post-unit-exercise">Post-Unit exercise</a></li>
</ul>
</li>
<li><a href="#key-terms">Key Terms</a></li>
<li><a href="#file-handling-in-c-language---quick-reference">File Handling in C Language - Quick Reference</a></li>
<li><a href="#files">Files</a>
<ul>
<li></li>
<li><a href="#binary-file-characteristics">Binary File Characteristics</a></li>
<li><a href="#files-and-streams">Files and Streams</a></li>
<li><a href="#types-of-file-processing">Types of file processing</a></li>
</ul>
</li>
<li><a href="#creating-a-sequential-access-file">Creating a Sequential Access file</a>
<ul>
<li><a href="#file-access-modes">File Access Modes</a></li>
<li><a href="#reading-sequential-access-file">Reading Sequential Access file</a></li>
<li><a href="#read-numbers-from-file-and-calculate-average">Read numbers from file and calculate Average</a></li>
</ul>
</li>
<li><a href="#random-access-file">Random access file</a>
<ul>
<li><a href="#creating-random-access-file">Creating Random Access File</a></li>
<li><a href="#writing-random-access-data">Writing Random Access Data</a>
<ul>
<li></li>
</ul>
</li>
<li><a href="#reading-random-access-data">Reading Random Access Data</a></li>
<li><a href="#transaction-processing-using-random-access-files">Transaction processing using random access files</a></li>
</ul>
</li>
<li><a href="#command-line-arguments">Command line arguments</a>
<ul>
<li><a href="#simple-example">Simple example</a></li>
<li><a href="#another-example">Another example</a></li>
<li><a href="#program-5.3">Program 5.3</a></li>
</ul>
</li>
<li><a href="#faq">FAQ</a></li>
<li><a href="#bonus-material">Bonus Material</a>
<ul>
<li></li>
<li><a href="#averaging-entries-from-stdin">Averaging entries from stdin</a></li>
<li><a href="#example-program-average-of-numbers">Example Program: Average of numbers</a></li>
<li><a href="#using-9999-as-eof">Using ‘9999’ as EOF</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="unit-v-file-processing">UNIT V FILE PROCESSING</h1>
<p><em>Files – Types of file processing: Sequential access, Random access – Sequential access file - Example Program: Finding average of numbers stored in sequential access file - Random access file - Example Program: Transaction processing using random access files – Command line arguments</em></p>
<p>[TOC]</p>
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#unit-v-file-processing">UNIT V FILE PROCESSING</a>
<ul>
<li><a href="#key-terms">Key Terms</a></li>
<li><a href="#file-handling-in-c-language---quick-reference">File Handling in C Language - Quick Reference</a></li>
<li><a href="#files">Files</a>
<ul>
<li><a href="#file-extensions">File Extensions</a></li>
<li><a href="#text-file-characteristics">Text File Characteristics</a></li>
<li><a href="#binary-file-characteristics">Binary File Characteristics</a></li>
<li><a href="#files-and-streams">Files and Streams</a></li>
<li><a href="#types-of-file-processing">Types of file processing</a></li>
</ul>
</li>
<li><a href="#creating-a-sequential-access-file">Creating a Sequential Access file</a>
<ul>
<li><a href="#file-access-modes">File Access Modes</a></li>
<li><a href="#reading-sequential-access-file">Reading Sequential Access file</a></li>
<li><a href="#read-numbers-from-file-and-calculate-average">Read numbers from file and calculate Average</a></li>
</ul>
</li>
<li><a href="#random-access-file">Random access file</a>
<ul>
<li><a href="#creating-random-access-file">Creating Random Access File</a></li>
<li><a href="#writing-random-access-data">Writing Random Access Data</a>
<ul>
<li><a href="#return-values">Return values</a></li>
</ul>
</li>
<li><a href="#reading-random-access-data">Reading Random Access Data</a></li>
<li><a href="#transaction-processing-using-random-access-files">Transaction processing using random access files</a></li>
</ul>
</li>
<li><a href="#command-line-arguments">Command line arguments</a>
<ul>
<li><a href="#simple-example">Simple example</a></li>
<li><a href="#program-53">Program 5.3</a></li>
</ul>
</li>
<li><a href="#faq">FAQ</a></li>
<li><a href="#bonus-material">Bonus Material</a></li>
</ul>
</li>
</ul>
<h3 id="online-references-attribution">Online References attribution</h3>
<ul>
<li>Understand <a href="https://www.go4expert.com/articles/understanding-c-file-handling-functions-t29966/">file functions</a></li>
<li>Quick reference on <a href="http://iiti.ac.in/people/~tanimad/FileHandlinginCLanguage.pdf">file handling</a></li>
<li>All about <a href="https://latedev.wordpress.com/2012/12/04/all-about-eof/">EOF</a></li>
</ul>
<h2 id="pre-unit-exercise---a-show-and-tell-exercise">Pre-Unit exercise - a “Show and Tell” exercise</h2>
<ol>
<li>Create your own paper document by writing a few numbers<br>
and words in 3-4 lines. Do not use cursive writing, instead<br>
use capital letters and write as neatly as possible. Here’s<br>
an <a href="http://j.mp/numberWords">example</a>.</li>
<li>Create a digital copy of the same (what will you use to<br>
create a scanned copy?)</li>
<li>Look inside the digital copy and examine it using a hex<br>
editor</li>
<li>Do an <strong>OCR</strong> of your digital copy and download a text<br>
version of your digital essay. Write down and share what<br>
you used to do an OCR on your own handwritten document.</li>
<li>Send the digital copy and the text file (created using<br>
your OCR effort) to your faculty’s email;</li>
<li>Create a github repository containing a digital scan of<br>
your document and an OCR’ed text file of your document</li>
<li>Bring the written document to class;  Bring a print out<br>
of the OCR’ed text file to class</li>
<li>If you do everything as per the steps above, you should<br>
end up with a snapshot of a cloned repo directory similar<br>
to the image below:</li>
</ol>
<p><img src="https://cdn.rawgit.com/kgashok/filesOCR/1d2f5c87/directoryImage.png" alt="ocr"></p>
<h2 id="post-unit-exercise">Post-Unit exercise</h2>
<ul>
<li>
<p>Read and resolve <a href="https://github.com/kgisl/cs8251/blob/master/quiz/filereader.c.md">this</a> mystery.</p>
</li>
<li>
<p>Try and understand Kilo project - <a href="https://github.com/kgisl/kilo">https://github.com/kgisl/kilo</a></p>
<ul>
<li><a href="https://github.com/kgisl/kilo/blob/7a34f41ab091a74fe7ccc3b6fea35f1ab6fb3c5f/kilo.c#L705">writing</a> to file</li>
<li><a href="https://github.com/kgisl/kilo/blob/7a34f41ab091a74fe7ccc3b6fea35f1ab6fb3c5f/kilo.c#L674">reading</a> to file</li>
<li>Implement a <code>&lt;Ctrl-O&gt;</code> option that loads in a new file into the editor</li>
</ul>
</li>
</ul>
<h1 id="key-terms">Key Terms</h1>
<ul>
<li><strong>Binary file</strong> : Binary file is a collection of bytes or a character stream. The data that is written into and read from binary file remain unchanged, with no separation between lines and no use of end-of-line characters and the interpretation of the file is left to the programmer.</li>
<li><strong>Text file</strong> :  A text file is a stream of characters that can be processed sequentially and logically in the forward direction. The maximum number of characters in each line is limited to 255 characters.</li>
<li><strong>Sequential file access</strong>: In case of sequential file access, data is read from or written to a file in a sequential manner while the <code>position indicator</code> automatically gets adjusted by the stream I/O functions.</li>
<li><strong>Random file access</strong>:  Random access means reading from or writing to any position in a file without reading or writing all the preceding data by controlling the <code>position indicator</code></li>
<li><strong>Record</strong>:  A record consist of a collection of data fields that conforms  to a previously defined structure that can be stored on or retrieved from a file.</li>
<li><strong>Stream</strong>:  The stream is a common, logical interface to the various devices that comprise the computer and is a logical interface to a file. Although files differ in form and capabilities, all streams are the same.</li>
<li><strong>File management</strong>:  It basically means all operations related to creating, renaming, deleting, merging, reading, writing, etc. of any type of files.</li>
<li><strong>Path</strong>: The path specifies the drive and/or directory (or folder) where the file is located. On PCs, the backslash character is used to separate directory names in a path. Some systems like Unix use the forward slash (/) as the directory separator.</li>
</ul>
<h1 id="file-handling-in-c-language---quick-reference">File Handling in C Language - Quick Reference</h1>
<p>A <strong>file</strong> represents a sequence of bytes on the disk where a group of related data is stored. File is created for permanent storage of data. It is a readymade structure.</p>
<p>In C language, we use a structure <strong>pointer of file type</strong> to declare a file.</p>
<pre><code>	FILE *fp;
</code></pre>
<p>C provides a number of functions that helps to perform basic file operations. Following are the functions,</p>

<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">fopen()</td>
<td align="left">create a new file or open a existing file</td>
</tr>
<tr>
<td align="left">fclose()</td>
<td align="left">closes a file</td>
</tr>
<tr>
<td align="left">getc()</td>
<td align="left">reads a character from a file</td>
</tr>
<tr>
<td align="left">putc()</td>
<td align="left">writes a character to a file</td>
</tr>
<tr>
<td align="left">fscanf()</td>
<td align="left">reads a set of data from a file</td>
</tr>
<tr>
<td align="left">fprintf()</td>
<td align="left">writes a set of data to a file</td>
</tr>
<tr>
<td align="left">getw()</td>
<td align="left">reads a integer from a file</td>
</tr>
<tr>
<td align="left">putw()</td>
<td align="left">writes a integer to a file</td>
</tr>
<tr>
<td align="left">fseek()</td>
<td align="left">set the position to desire point</td>
</tr>
<tr>
<td align="left">ftell()</td>
<td align="left">gives current position in the file</td>
</tr>
<tr>
<td align="left">rewind()</td>
<td align="left">set the position to the beginning point</td>
</tr>
<tr>
<td align="left">fread()</td>
<td align="left">reads specific number of bytes from binary file</td>
</tr>
<tr>
<td align="left">fwrite()</td>
<td align="left">writes specific number of bytes to binary files</td>
</tr>
</tbody>
</table><p><strong>Opening a File or Creating a File</strong></p>
<p>The <code>fopen()</code> function is used to create a new file or to open an existing file.</p>
<p><strong>General Syntax :</strong></p>
<p><code>*fp = FILE fopen(const char _*filename_ , const char _*mode_ );</code></p>
<p>Here <strong>filename</strong> is the name of the file to be opened and <strong>mode</strong> specifies the purpose of opening the file. Mode can be of following types,</p>
<p><strong>*fp</strong> is the FILE pointer (*<em>FILE <em>fp</em></em> ), which will hold the reference to the opened (or created) file.</p>
<p><strong>Closing a File</strong></p>
<p>The fclose() function is used to close an already opened file.</p>
<p><strong>General Syntax :</strong></p>
<p>int <strong>fclose</strong> ( FILE <em>*fp</em> );<br>
Here fclose() function closes the file and returns <strong>zero</strong> on success, or <strong>EOF</strong> if there is an error in closing the file. This <strong>EOF</strong> is a constant defined in the header file <strong>stdio.h</strong>.</p>
<p><strong>Input/Output operation on File</strong></p>
<p>In the above table we have discussed about various file I/O functions to perform reading and writing on file. getc() and putc() are simplest functions used to read and write individual characters to a file.</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;conio.h&gt;</span></span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
	<span class="token keyword">char</span> ch<span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span> <span class="token punctuation">(</span><span class="token string">"one.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">putc</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"one.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">getc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Reading and Writing from File using fprintf() and fscanf()</strong></p>
<pre class=" language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;conio.h&gt;</span></span>
<span class="token keyword">struct</span> emp
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">struct</span> emp e<span class="token punctuation">;</span>
	FILE <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token operator">*</span>q<span class="token punctuation">;</span>
	p <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"one.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	q <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"one.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter Name and Age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s %d"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fprintf</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token string">"%s %d"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{</span>
	    <span class="token function">fscanf</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token string">"%s %d"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s %d"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p>In this program, we have create two FILE pointers and both are refering to the same file but in different modes. <strong>fprintf()</strong> function directly writes into the file, while <strong>fscanf()</strong> reads from the file, which can then be printed on console usinf standard <strong>printf()</strong> function.</p>
<p><strong>Difference between Append and Write Mode</strong></p>
<p>Write (w) mode and Append (a) mode, while opening a file are almost the same. Both are used to write in a file. In both the modes, new file is created if it doesn’t exists already.</p>
<p>The only difference they have is, when you open a file in the write mode, the file is reset, resulting in deletion of any data already present in the file. While in append mode this will not happen. Append mode is used to append or add data to the existing data of file (if any). Hence, when you open a file in Append(a) mode, the cursor is positioned at the end of the present data in the file.</p>
<p><strong>Reading and Writing in a Binary File</strong></p>
<p>A Binary file is similar to the text file, but it contains only large numerical data. The Opening modes are mentioned in the table for opening modes above.</p>
<p><strong>fread()</strong> and <strong>fwrite()</strong> functions are used to read and write is a binary file.</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token function">fwrite</span><span class="token punctuation">(</span>data_element_to_be_written<span class="token punctuation">,</span> size_of_element<span class="token punctuation">,</span>number_of_elements<span class="token punctuation">,</span> pointer_to_file<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>fread()</strong> is also used in the same way, with the same arguments like fwrite() function. Below mentioned is a simple example of writing into a binary file</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token keyword">const</span> <span class="token keyword">char</span> mytext <span class="token operator">=</span> <span class="token string">"The quick brown fox jumps over the lazy dog"</span><span class="token punctuation">;</span>
FILE <span class="token operator">*</span>bfp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>bfp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">fwrite</span><span class="token punctuation">(</span>mytext <span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>mytext<span class="token punctuation">)</span> <span class="token punctuation">,</span> bfp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>bfp<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>fseek(), ftell() and rewind() functions</strong></p>
<ul>
<li><strong>fseek()</strong> - It is used to move the reading control to different positions using fseek function.</li>
<li><strong>ftell()</strong> - It tells the byte location of current position of cursor in file pointer.</li>
<li><strong>rewind()</strong> - It moves the control to beginning of the file.</li>
</ul>
<hr>
<h1 id="files">Files</h1>
<p><strong>What are files?</strong>  A file is sequential stream of bytes ending with an end-of-file marker.</p>
<p>As we know, at the time of execution, every program is executed in the main memory. Main memory is volatile and the data would be lost once the program is terminated. If we need the same data again, we have to store the data in a file on the disk. A file is sequential stream of bytes ending with an end-of-file marker.</p>
<p>Storage of data in variables and arrays is temporary—such data is lost when a program terminates. Files are used for permanent retention of data. Computers store files on secondary storage devices, such as hard drives, CDs, DVDs and flash drives. In this chapter, we explain how data files are created, updated and processed by C programs. We consider both sequential-access and random-access file processing.</p>
<h3 id="file-extensions">File Extensions</h3>
<p>File extensions<br>
We can usually tell if a file is binary or text based on its file extension. This is because by convention the extension reflects the file format, and it is ultimately the file format that dictates whether the file data is binary or text.</p>
<p>Common extensions that are binary file formats:</p>
<pre><code>Images: jpg, png, gif, bmp, tiff, psd, ...
Videos: mp4, mkv, avi, mov, mpg, vob, ...
Audio: mp3, aac, wav, flac, ogg, mka, wma, ...
Documents: pdf, doc, xls, ppt, docx, odt, ...
Archive: zip, rar, 7z, tar, iso, ...
Database: mdb, accde, frm, sqlite, ...
Executable: exe, dll, so, class, ...
</code></pre>
<p>Common extensions that are text file formats:</p>
<pre><code>Web standards: html, xml, css, svg, json, ...
Source code: c, cpp, h, cs, js, py, java, rb, pl, php, sh, ...
Documents: txt, tex, markdown, asciidoc, rtf, ps, ...
Configuration: ini, cfg, rc, reg, ...
Tabular data: csv, tsv, ...
</code></pre>
<h3 id="text-file-characteristics">Text File Characteristics</h3>
<p>By convention, the data in every text file obeys a number of rules:</p>
<ul>
<li>The text looks readable to a human or at least moderately sane. Even if it contains a heavy proportion of punctuation symbols (like HTML, RTF, and other markup formats), there is some visible structure and it’s not seemingly random garbage.</li>
<li>The data format is usually line-oriented. Each line could be a separate command, or a list of values could put each item on a different line, etc. The maximum number of characters in each line is usually a reasonable value like 100, not like 1000.</li>
<li>The text looks readable to a human or at least moderately sane. Even if it contains a heavy proportion of punctuation symbols (like HTML, RTF, and other markup formats), there is some visible structure and it’s not seemingly random garbage.</li>
</ul>
<h2 id="binary-file-characteristics">Binary File Characteristics</h2>
<ul>
<li>For most software that people use in their daily lives, the software consumes and produces binary files. Examples of such software include Microsoft Office, Adobe Photoshop, and various audio/video/media players. A typical computer user works with mostly binary files and very few text files.</li>
<li>A binary file always needs a matching software to read or write it. For example, an MP3 file can be produced by a sound recorder or audio editor, and it can be played in a music player or audio editor. But an MP3 file cannot be played in an image viewer or a database software.</li>
<li>Some binary formats are popular enough that a wide variety of programs can produce or consume it. Image formats like JPEG are the best example – not only can they be used in image viewers and editors, they can be viewed in web browsers, audio players (for album art), and document software (such as adding a picture into a Word doc).</li>
</ul>
<h2 id="files-and-streams">Files and Streams</h2>
<p>C views each file simply as a sequential stream of bytes (Fig. 11.1). Each file ends either<br>
with an <code>end-of-file (EOF)</code> marker or at a specific byte number recorded in a system-maintained,<br>
administrative data structure. When a file is opened, a stream is associated with it. Three<br>
files and their associated streams are automatically opened when program execution begins — the standard input, the standard output and the standard error. Streams provide<br>
communication channels between files and programs. For example, the standard input<br>
stream enables a program to read data from the keyboard, and the standard output stream enables a program to print data on the screen. Opening a file returns a pointer to a FILE structure (defined in <code>&lt;stdio.h&gt;</code>) that contains information used to process the file. In some operating systems, this structure includes a file descriptor, i.e., an index into an operating system array called the open file table. Each array element contains a file control block (FCB)—information that the operating system uses to administer a particular file.</p>
<p>The standard input, standard output and standard error are manipulated using file pointers <code>stdin</code>, <code>stdout</code> and <code>stderr</code>.</p>
<p>The standard library provides many functions for reading data from files and for writing data to files. Function <code>fgetc</code>, like <code>getchar</code>, reads one character from a file. Function <code>fgetc</code> receives as an argument a FILE pointer for the file from which a character will be read. The call <code>fgetc(stdin)</code> reads one character from <code>stdin</code>—the standard input. This call is equivalent to the call <code>getchar()</code>.</p>
<p>Function <code>fputc</code>, like <code>putchar</code>, writes one character to a file. Function <code>fputc</code> receives<br>
as arguments a character to be written and a pointer for the file to which the character will be written. The function call <code>fputc('a', stdout)</code> writes the character ‘a’ to <code>stdout</code>— the standard output. This call is equivalent to <code>putchar('a')</code>.</p>
<p>Several other functions used to read data from standard input and write data to standard<br>
output have similarly named file-processing functions. The fgets and fputs functions,<br>
for example, can be used to read a line from a file and write a line to a file, respectively.<br>
In the next several sections, we introduce the file-processing equivalents of functions <code>scanf</code> and <code>printf</code>— <code>fscanf</code> and <code>fprintf</code>.</p>

<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">fopen</td>
<td align="left">open a file for either sequential or random access</td>
</tr>
<tr>
<td align="left">fclose</td>
<td align="left">close a file that has been opened for access</td>
</tr>
<tr>
<td align="left">fprintf</td>
<td align="left">Write to sequential (or text) file</td>
</tr>
<tr>
<td align="left">fscanf</td>
<td align="left">Read from sequential (or text) file</td>
</tr>
<tr>
<td align="left">fread</td>
<td align="left">Read from random (or binary) file</td>
</tr>
<tr>
<td align="left">rwrite</td>
<td align="left">Write to random (or binary) file</td>
</tr>
</tbody>
</table><h2 id="types-of-file-processing">Types of file processing</h2>
<ul>
<li>There are two types of files - text and binary files</li>
<li>There are two techniques for processing files - sequential and random</li>
</ul>
<p>Every open file has an associated <code>file position indicator</code>, which describes where read and write operations take place in the file. The position is always specified in bytes from the beginning of the file. When a new file is opened, the position indicator is always at the beginning of the file, i.e., at <code>position 0</code>.</p>
<ul>
<li>
<p>Writing and reading operations occur at the location of the position indicator and update the position indicator as well. Thus, if one wishes to read all the data in a file sequentially or write data to a file sequentially, it is not necessary to be concerned about the <code>position indicator</code> because the stream I/O functions take care of it automatically.</p>
</li>
<li>
<p>When more control is required, the C library functions that help determine and change the value of the <code>file position indicator</code>, have to be used. By controlling the position indicator, random access of a file can be made possible. Here, random means that data can be read from, or written to, any position in a file without reading or writing all the preceding data.</p>
</li>
</ul>
<h1 id="creating-a-sequential-access-file">Creating a Sequential Access file</h1>
<p>C imposes no structure on a file. Thus, notions such as a record of a file do not exist as part of the C language. The following example shows how you can impose your own record structure on a file.</p>
<p><img src="http://j.mp/seqFile" alt="sequential"></p>
<p>Figure 11.2 creates a simple sequential-access file that might be used in an accounts<br>
receivable system to keep track of the amounts owed by a company’s credit clients.</p>
<ul>
<li>For each client, the program obtains an account number, the client’s name and the client’s balance (i.e., the amount the client owes the company for goods and services received in the past). The data obtained for each client constitutes a <strong>“record”</strong> for that client.</li>
<li>The <strong>account number</strong> is used as the record key in this application—the file will be created and maintained in account-number order. This program assumes the user enters the records in account number order.</li>
<li>In a comprehensive accounts receivable system, a sorting capability would be provided so the user could enter the records in any order. The records would then be sorted and written to the file.</li>
</ul>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">// Fig. 11.2: fig11_02.c</span>
<span class="token comment">// Creating a sequential file</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> account<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">// account name</span>
  <span class="token keyword">double</span> balance<span class="token punctuation">;</span>        <span class="token comment">// account balance</span>

  FILE<span class="token operator">*</span> cfPtr<span class="token punctuation">;</span>  <span class="token comment">// cfPtr = clients.dat file pointer</span>

  <span class="token comment">// fopen opens file. Exit program if unable to create file</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cfPtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"clients.dat"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter the account, name, and balance."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter EOF to end input."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%29s%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>account<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// write account, name and balance into file with fprintf</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fprintf</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">,</span> <span class="token string">"%d %s %.2f\n"</span><span class="token punctuation">,</span> account<span class="token punctuation">,</span> name<span class="token punctuation">,</span> balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d%29s%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>account<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  <span class="token comment">// end while</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes file</span>
  <span class="token punctuation">}</span>                 <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end main</span>
</code></pre>
<p><strong>OUTPUT</strong></p>
<pre><code>Enter the account, name, and balance.
Enter EOF to end input.
? 100 Jones 24.98
? 200 Doe 345.67
? 300 White 0.00
? 400 Stone -42.16
? 500 Rich 224.62
? ^D (or ^Z)
</code></pre>
<p>Now let’s examine this program. Line 11 states that <code>cfPtr</code> is a pointer to a FILE structure. A C program administers each file with a separate FILE structure.</p>
<p>Each open file must have a separately declared pointer of type FILE that’s used to refer<br>
to the file. Line 14 names the file— <strong>“clients.dat”</strong> —to be used by the program and establishes a “line of communication” with the file. The file pointer <strong>cfPtr</strong> is assigned a pointer to the FILE structure for the file opened with <strong>fopen</strong>. Function fopen takes two arguments: a <strong>filename</strong> (which can include path information leading to the file’s location) and a <strong>file open mode</strong>.</p>
<p>The file open mode “w” indicates that the file is to be opened for writing. If a file does not exist and it’s opened for writing, fopen creates the file. If an existing file is opened for writing, the contents of the file are discarded without warning. In the program, the if statement is used to determine whether the file pointer cfPtr is NULL (i.e., the file is not opened). If it’s NULL, the program prints an error message and terminates. Otherwise, the program processes the input and writes it to the file.</p>
<p>The program prompts the user to enter the various fields for each record or to enter<br>
end-of-file when data entry is complete. Figure 11.3 lists the key combinations for entering <strong>end-of-file</strong> (<strong><code>EOF</code></strong>)for various computer systems.</p>
<pre><code>Operating system       Key combination
Linux/Mac OS X/UNIX    &lt;Ctrl&gt; d
Windows                &lt;Ctrl&gt; z
</code></pre>
<p>Line 24 uses function feof to determine whether the end-of-file indicator is set for<br>
the file to which stdin refers. The end-of-file indicator informs the program that there’s no more data to be processed. In Fig. 11.2, the end-of-file indicator is set for the standard input when the user enters the end-of-file key combination. The argument to function <strong>feof</strong> is a pointer to the file being tested for the end-of-file indicator (stdin in this case). The function returns a nonzero (true) value when the end-of-file indicator has been set; otherwise, the function returns zero. The while statement that includes the feof call in this program continues executing while the end-of-file indicator is not set.<br>
Line 25 writes data to the file <code>clients.dat</code>. The data may be retrieved later by a program<br>
designed to read the file (see Section 11.4). Function <strong>fprintf</strong> is equivalent to printf except that fprintf also receives as an argument a file pointer for the file to which<br>
the data will be written. Function <strong>fprintf</strong> can output data to the standard output by<br>
using <strong>stdout</strong> as the file pointer, as in:</p>
<pre><code>`fprintf( stdout, "%d %s %.2f\n", account, name, balance );`
</code></pre>
<p>After the user enters end-of-file, the program closes the clients.dat file with fclose<br>
and terminates. Function fclose also receives the file pointer (rather than the filename)<br>
as an argument. If function <strong>fclose</strong> is not called explicitly, the operating system normally will close the file when program execution terminates. This is an example of operating system “housekeeping.”</p>
<h2 id="file-access-modes">File Access Modes</h2>
<p>Programs may process no files, one file or several files. Each file used in a program will<br>
have a different file pointer returned by fopen. All subsequent file-processing functions after the file is opened must refer to the file with the appropriate file pointer. Files may be opened in one of several modes (Fig. 11.5). <strong>The binary modes are used in Sections 11.5–11.9 when we introduce random-access files.</strong></p>
<p>If an error occurs while opening a file in any mode, fopen returns <strong>NULL</strong>.</p>

<table>
<thead>
<tr>
<th align="left">Mode</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">r</td>
<td align="left">Open an existing file for reading.</td>
</tr>
<tr>
<td align="left">w</td>
<td align="left">Create a file for writing. If the file already exists, discard the current contents.</td>
</tr>
<tr>
<td align="left">a, a+</td>
<td align="left">Append: open or create a file for writing at the end of the file.</td>
</tr>
<tr>
<td align="left">r+</td>
<td align="left">Open an existing file for update (reading and writing).</td>
</tr>
<tr>
<td align="left">w+</td>
<td align="left">Create a file for update. If the file already exists, discard the current contents.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="left">Mode</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">rb</td>
<td align="left">opens a binary file in reading mode</td>
</tr>
<tr>
<td align="left">wb</td>
<td align="left">opens or create a binary file in writing mode</td>
</tr>
<tr>
<td align="left">ab, ab+</td>
<td align="left">opens a binary file in append mode</td>
</tr>
<tr>
<td align="left">rb+</td>
<td align="left">opens a binary file in both reading and writing mode</td>
</tr>
<tr>
<td align="left">wb+</td>
<td align="left">opens a binary file in both reading and writing mode</td>
</tr>
</tbody>
</table><h2 id="reading-sequential-access-file">Reading Sequential Access file</h2>
<p>Data is stored in files so that the data can be retrieved for processing when needed. The<br>
previous section demonstrated how to create a file for sequential access. This section shows how to read data sequentially from a file.</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">// Fig. 11.6: fig11_06.c</span>
<span class="token comment">// Reading and printing a sequential file</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> account<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">// account name</span>
  <span class="token keyword">double</span> balance<span class="token punctuation">;</span>        <span class="token comment">// account balance</span>

  FILE <span class="token operator">*</span>cfPtr<span class="token punctuation">;</span>  <span class="token comment">// cfPtr = clients.dat file pointer</span>

  <span class="token comment">// fopen opens file; exits program if file cannot be opened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cfPtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"clients.dat"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>       <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// read account, name and balance from file</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-10s%-13s%s\n"</span><span class="token punctuation">,</span> <span class="token string">"Account"</span><span class="token punctuation">,</span> <span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token string">"Balance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fscanf</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">,</span> <span class="token string">"%d%29s%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>account<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// while not end of file</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-10d%-13s%7.2f\n"</span><span class="token punctuation">,</span> account<span class="token punctuation">,</span> name<span class="token punctuation">,</span> balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fscanf</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">,</span> <span class="token string">"%d%29s%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>account<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  <span class="token comment">// end while</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes the file</span>
  <span class="token punctuation">}</span>                 <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end main</span>

</code></pre>
<p>Figure 11.6 reads records from the file “clients.dat” created by the program of Fig. 11.2 and prints their contents. Line 11 indicates that cfPtr is a pointer to a FILE. Line 14 attempts to open the file “clients.dat” for reading (“r”) and determines whether it opened successfully (i.e., fopen does not return NULL). Line 19 reads a “record” from the file. Function fscanf is equivalent to function scanf, except fscanf receives as an argument a file pointer for the file from which the data is read. After this statement executes the first time, account will have the value 100, name will have the value “Jones” and balance will have the value 24.98.</p>
<p>Each time the second fscanf statement (line 24) executes, the program reads another record from the file and account, name and balance take on new values. When the program reaches the end of the file, the file is closed (line 27) and the program terminates. Function feof returns true only after the program attempts to<br>
read the nonexistent data following the last line.</p>
<p><strong>Resetting the File Position Pointer</strong><br>
To retrieve data sequentially from a file, a program normally starts reading from the beginning of the file and reads all data consecutively until the desired data is found. It may be desirable to process the data sequentially in a file several times (from the beginning of the file) during the execution of a program. The statement</p>
<pre><code>rewind( cfPtr );
</code></pre>
<p>causes a program’s file position pointer—which indicates the number of the next byte in<br>
the file to be read or written—to be repositioned to the beginning of the file (i.e., byte 0)<br>
pointed to by cfPtr. The file position pointer is not really a pointer. Rather it’s an integer<br>
value that specifies the byte in the file at which the next read or write is to occur. This is<br>
sometimes referred to as the file offset. The file position pointer is a member of the FILE<br>
structure associated with each file.</p>
<h2 id="read-numbers-from-file-and-calculate-average">Read numbers from file and calculate Average</h2>
<p>The next program reads five (or more) integer values from the data file <code>num.dat</code>. In this program end-of-file marker <code>EOF</code> is used to exit the loop.</p>
<pre class=" language-c"><code class="prism  language-c">
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Reading numbers from num.dat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fscanf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d "</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sum <span class="token operator">+</span><span class="token operator">=</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">float</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> i<span class="token punctuation">;</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The average is %f for %d numbers\n"</span><span class="token punctuation">,</span> average<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No data available in num.dat!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unable to open num.dat...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<h1 id="random-access-file">Random access file</h1>
<p>As we stated previously, records in a file created with the formatted output function<br>
<strong>fprintf</strong> are not necessarily the same length. However, individual records of a random access file are normally fixed in length and may be accessed directly (and thus quickly)<br>
without searching through other records. This makes random-access files appropriate for<br>
airline reservation systems, banking systems, point-of-sale systems, and other kinds of<br>
transaction-processing systems that require rapid access to specific data. There are other ways of implementing random-access files, but we’ll limit our discussion to this straightforward approach using fixed-length records.</p>
<ul>
<li>Because every record in a random-access file normally has the same length, the exact<br>
location of a record relative to the beginning of the file can be calculated as a function of the record key. We’ll soon see how this facilitates immediate access to specific records, even in large files.</li>
<li>Figure below illustrates one way to implement a random-access file. Such a file is like a freight train with many cars—some empty and some with cargo. Each car in the train has the same length.</li>
</ul>
<p><img src="http://j.mp/randFile" alt="rand"></p>
<p>Fixed-length records enable data to be inserted in a random-access file without<br>
destroying other data in the file. Data stored previously can also be updated or deleted<br>
without rewriting the entire file. In the following sections we explain how to create a<br>
random-access file, enter data, read the data both sequentially and randomly, update the<br>
data, and delete data no longer needed.</p>
<h2 id="creating-random-access-file">Creating Random Access File</h2>
<p>Function <strong>fwrite</strong> transfers a specified number of bytes beginning at a specified location in memory to a file. The data is written beginning at the location in the file indicated by the file position pointer. Function fread transfers a specified number of bytes from the location in the file specified by the file position pointer to an area in memory beginning with a specified address. Now, when writing an integer, instead of using</p>
<pre><code>fprintf(fPtr, "%d", number);
</code></pre>
<p>which could print a single digit or as many as 11 digits (10 digits plus a sign, each of which requires 1 byte of storage) for a four-byte integer, we can use</p>
<pre><code>fwrite(&amp;number, sizeof(int), 1, fPtr);
</code></pre>
<p>which always writes four bytes on a system with four-byte integers from a variable number to the file represented by <code>fPtr</code> (we’ll explain the <code>1</code> argument shortly). Later, <strong>fread</strong> can be used to read those four bytes into an integer variable number. Although fread and fwrite read and write data, such as integers, in fixed-size rather than variable-size format, the data they handle are processed in computer “raw data” format (i.e., bytes of data) rather than in <strong>printf</strong>’s and <strong>scanf</strong>’s human-readable text format. Because the “raw” representation of data is <em>system dependent</em>, “raw data” may not be readable on other systems, or by programs produced by other compilers or with other compiler options.</p>
<p>Functions <strong>fwrite</strong> and <strong>fread</strong> are capable of reading and writing arrays of data to and from disk. The third argument of both fread and fwrite is the number of elements in the array that should be read from or written to disk. The preceding fwrite function call writes a single integer to disk, so the third argument is 1 (as if one element of an array is being written). File-processing programs rarely write a single field to a file. Normally, they write one struct at a time, as we show in the following examples.</p>
<p>Consider the following problem statement:</p>
<pre><code>Create a credit-processing system capable of storing up to 100 fixed-length records. Each record should consist of an account number that will be used as the record key, a last name, a first name and a balance. The resulting program should be able to update an account, insert a new account record, delete an account and list all the account records in a formatted text file for printing. Use a random-access file.
</code></pre>
<p>The next several sections introduce the techniques necessary to create the credit-processing program. Figure 11.10 shows how to open a random-access file, define a record format using a struct, write data to the disk and close the file. This program initializes all 100 records of the file “credit.dat” with empty structs using the function fwrite. Each empty struct contains <code>0</code> for the account number, <code>""</code> (the empty string) for the last name, <code>""</code> for the first name and 0.0 for the balance. The file is initialized in this manner to create space on disk in which the file will be stored and to make it possible to determine whether a record contains data.</p>
<pre class=" language-c"><code class="prism  language-c">
<span class="token comment">// Fig. 11.10: fig11_10.c</span>
<span class="token comment">// Creating a random-access file sequentially</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token comment">// clientData structure definition</span>
<span class="token keyword">struct</span> clientData <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> acctNum<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">char</span> lastName<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// account last name</span>
  <span class="token keyword">char</span> firstName<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// account first name</span>
  <span class="token keyword">double</span> balance<span class="token punctuation">;</span>        <span class="token comment">// account balance</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                       <span class="token comment">// end structure clientData</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>  <span class="token comment">// counter used to count from 1-100</span>
  <span class="token comment">// create clientData with default information</span>
  <span class="token keyword">struct</span> clientData blankClient <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  FILE <span class="token operator">*</span>cfPtr<span class="token punctuation">;</span>  <span class="token comment">// credit.dat file pointer</span>

  <span class="token comment">// fopen opens the file; exits if file cannot be opened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cfPtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"credit.dat"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// output 100 blank records to file</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>blankClient<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 

    <span class="token function">fclose</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes the file</span>
  <span class="token punctuation">}</span>                 <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end main</span>

</code></pre>
<p>Function <strong>fwrite</strong> writes a block of bytes to a file. Line 29 causes the structure blankClient of size <code>sizeof(struct clientData)</code> to be written to the file pointed to by cfPtr. The operator sizeof returns the size in bytes of its operand in parentheses (in this case <code>struct clientData</code>). Function <strong>fwrite</strong> can actually be used to write several elements of an array of objects. To do so, supply in the call to <strong>fwrite</strong> a pointer to an array as the first argument and the number of elements to be written as the third argument. In the preceding statement, <strong>fwrite</strong> was used to write a single object that was not an array element. Writing a single object is equivalent to writing one element of an array, hence the 1 in the <strong>fwrite</strong> call.</p>
<h2 id="writing-random-access-data">Writing Random Access Data</h2>
<p>Figure 11.11 writes data to the file <strong>“credit.dat”</strong>. It uses the combination of <strong>fseek</strong> and <strong>fwrite</strong> to store data at specific locations in the file. Function fseek sets the file position pointer to a specific position in the file, then fwrite writes the data. A sample execution is shown in Fig. 11.12.</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">// Fig. 11.11: fig11_11.c</span>
<span class="token comment">// Writing data randomly to a random-access file</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token comment">// clientData structure definition</span>
<span class="token keyword">struct</span> clientData <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> acctNum<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">char</span> lastName<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// account last name</span>
  <span class="token keyword">char</span> firstName<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// account first name</span>
  <span class="token keyword">double</span> balance<span class="token punctuation">;</span>        <span class="token comment">// account balance</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                       <span class="token comment">// end structure clientData</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  FILE <span class="token operator">*</span>cfPtr<span class="token punctuation">;</span>  <span class="token comment">// credit.dat file pointer</span>

  <span class="token comment">// create clientData with default information</span>
  <span class="token keyword">struct</span> clientData client <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// fopen opens the file; exits if file cannot be opened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cfPtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"credit.dat"</span><span class="token punctuation">,</span> <span class="token string">"rb+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// require user to specify account number</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>
           <span class="token string">"Enter account number"</span>
           <span class="token string">"(1 to 100, 0 to end input)\n?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>client<span class="token punctuation">.</span>acctNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// user enters information, which is copied into file</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>acctNum <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// user enters last name, first name and balance</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter lastname, firstname, balance\n? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// set record lastName, firstName and balance value</span>
      <span class="token function">fscanf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token string">"%14s%9s%lf"</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span> client<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span>
             <span class="token operator">&amp;</span>client<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// seek position in file to user-specified record</span>
      <span class="token function">fseek</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>acctNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// write user-specified information in file</span>
      <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// enable user to input another account number</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter account number\n? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>client<span class="token punctuation">.</span>acctNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  <span class="token comment">// end while</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes the file</span>
  <span class="token punctuation">}</span>                 <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end main</span>

</code></pre>
<p>We position the file position pointer for the file referenced by cfPtr to the<br>
byte location calculated by</p>
<pre><code>`(client.accountNum - 1) * sizeof(struct clientData)`.
</code></pre>
<p>The value of this expression is called the offset or the displacement. Because the account number is between 1 and 100 but the byte positions in the file start with 0, 1 is subtracted from the account number when calculating the byte location of the record. Thus, for record 1, the file position pointer is set to byte 0 of the file. The symbolic constant <code>SEEK_SET</code> indicates that the file position pointer is positioned relative to the beginning of the file by the amount of the offset. As the above statement indicates, a seek for account number <code>1</code> in the file sets the file position pointer to the beginning of the file because the byte location calculated is 0.</p>
<pre><code>int fseek( FILE *stream, long int offset, int whence );
</code></pre>
<p>The function prototype for <strong>fseek</strong> is where offset is the number of bytes to seek from whence in the file pointed to by stream—a positive offset seeks forward and a negative one seeks backward. Argument whence is one of the values <code>SEEK_SET</code>, <code>SEEK_CUR</code> or <code>SEEK_END</code> (all defined in <code>&lt;stdio.h&gt;</code>), which indicate the location from which the seek begins.</p>
<pre><code>SEEK_SET - the seek starts at the beginning of the file 
SEEK_CUR - the seek starts at the current location in the file and 
SEEK_END - the seek starts at the end of the file 
</code></pre>
<h4 id="return-values">Return values</h4>
<ul>
<li>Function fscanf returns the number of data items successfully read or the value <strong>EOF</strong> if a problem occurs while reading data.</li>
<li>Function <strong>fseek</strong> returns a nonzero value if the seek operation cannot be performed.</li>
<li>Function <strong>fwrite</strong> returns the number of items it successfully output. If this number is less than the third argument in the function call, then a write error occurred.</li>
</ul>
<h2 id="reading-random-access-data">Reading Random Access Data</h2>
<p>Function <strong>fread</strong> reads a specified number of bytes from a file into memory. For example,</p>
<pre><code>fread(&amp;client, sizeof(struct clientData), 1, cfPtr);
</code></pre>
<p>reads the number of bytes determined by <code>sizeof(struct clientData)</code> from the file referenced by <strong>cfPtr</strong>, stores the data in client and returns the number of bytes read. The bytes are read from the location specified by the file position pointer. Function <code>fread</code> can read several fixed-size array elements by providing a pointer to the array in which the elements will be stored and by indicating the number of elements to be read. The preceding statement reads one element.</p>
<p>To read more than one, specify the number of elements as <strong>fread</strong>’s third argument. Function fread returns the number of items it successfully input. If this number is less than the third argument in the function call, then a read error occurred.</p>
<p>Figure 11.14 reads sequentially every record in the “<strong>credit.dat</strong>” file, determines whether each record contains data and displays the formatted data for records containing data. Function <strong>feof</strong> determines when the end of the file is reached, and the <strong>fread</strong> function transfers data from the file to the <code>clientData</code> structure client.</p>
<pre class=" language-c"><code class="prism  language-c">
<span class="token comment">// Fig. 11.14: fig11_14.c</span>
<span class="token comment">// Reading a random-access file sequentially</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token comment">// clientData structure definition</span>
<span class="token keyword">struct</span> clientData <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> acctNum<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">char</span> lastName<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// account last name</span>
  <span class="token keyword">char</span> firstName<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// account first name</span>
  <span class="token keyword">double</span> balance<span class="token punctuation">;</span>        <span class="token comment">// account balance</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                       <span class="token comment">// end structure clientData</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  FILE <span class="token operator">*</span>cfPtr<span class="token punctuation">;</span>  <span class="token comment">// credit.dat file pointer</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span>   <span class="token comment">// used to test whether fread read any bytes</span>

  <span class="token comment">// create clientData with default information</span>
  <span class="token keyword">struct</span> clientData client <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// fopen opens the file; exits if file cannot be opened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cfPtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"credit.dat"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-6s%-16s%-11s%10s\n"</span><span class="token punctuation">,</span> <span class="token string">"Acct"</span><span class="token punctuation">,</span> <span class="token string">"Last Name"</span><span class="token punctuation">,</span> <span class="token string">"First Name"</span><span class="token punctuation">,</span>
           <span class="token string">"Balance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// read all records from file (until eof)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// display record</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> client<span class="token punctuation">.</span>acctNum <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-6d%-16s%-11s%10.2f\n"</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>acctNum<span class="token punctuation">,</span> client<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span>
               client<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span> client<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
    <span class="token punctuation">}</span>    <span class="token comment">// end while</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes the file</span>
  <span class="token punctuation">}</span>                 <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end main</span>

</code></pre>
<p><strong>OUTPUT</strong></p>
<pre><code>Acct Last Name First Name Balance
  29 Brown     Nancy      -24.54
  33 Dunn      Stacey     314.33
  37 Barker    Doug         0.00
  88 Smith     Dave       258.34
  96 Stone     Sam         34.98
</code></pre>
<p><strong>Fig. 11.14 | Reading a random-access file sequentially. (Part 2 of 2.)</strong></p>
<h2 id="transaction-processing-using-random-access-files">Transaction processing using random access files</h2>
<p>We now present a substantial transaction-processing program using <strong>random access</strong> files. The program maintains a bank’s account information—updating existing accounts, adding new accounts, deleting accounts and storing a listing of all the current accounts in a text file for printing. We assume that the program of Fig. 11.10 (see program under <a href="#creating-random-access-file">“Creating Random Access File”</a> heading) has been executed to create the file <strong>credit.dat</strong>.</p>
<p>The program has five options.</p>
<p><strong>Option 1</strong> calls function textFile (lines 63–94) to store a formatted list of all the accounts (typically called a report) in a text file called accounts.txt that may be printed later. The function uses fread and the sequential file access techniques used in the program of Section below.</p>
<p>After <strong>option 1</strong> is chosen, the file <strong>accounts.txt</strong> contains:</p>
<pre><code>Acct Last Name First Name Balance
	29   Brown     Nancy        -24.54
	33   Dunn      Stacey       314.33
	37   Barker    Doug           0.00
	88   Smith     Dave         258.34
	96   Stone     Sam           34.98
</code></pre>
<p><strong>Option 2</strong> calls the function <strong>updateRecord</strong> (lines 97–141) to update an account. The function will update only a record that already exists, so the function first checks whether the record specified by the user is empty. The record is read into structure client with fread, then member acctNum is compared to 0. If it’s 0, the record contains no information, and a message is printed stating that the record is empty. Then the menu choices are displayed. If the record contains information, function updateRecord inputs the transaction amount, calculates the new balance and rewrites the record to the file. A typical output for option 2 is</p>
<pre><code>Enter account to update ( 1 - 100 ): 37
37 Barker Doug 0.00
Enter charge ( + ) or payment ( - ): +87.99
37 Barker Do
</code></pre>
<p><strong>Option 3</strong> calls the function newRecord to add a new account to the file. If the user enters an account number for an existing account, newRecord displays an error message indicating that the record already contains information, and the menu choices are printed again. This function uses the same process to add a new account as does the program in Fig. 11.11. A typical output for option 3 is</p>
<pre><code>Enter new account number ( 1 - 100 ): 22
Enter lastname, firstname, balance
? Johnston Sarah 247.45
</code></pre>
<p><strong>Option 4</strong> calls function deleteRecord to delete a record from the file. Deletion is accomplished by asking the user for the account number and reinitializing the record. If the account contains no information, deleteRecord displays an error message indicating that the account does not exist.</p>
<p><strong>Option 5</strong> terminates program execution. The program is shown in Fig. 11.15. The file “credit.dat” is opened for update (reading and writing) using “rb+” mode.</p>
<pre class=" language-c"><code class="prism  language-c">
<span class="token comment">// Bank-account program reads a random-access file sequentially,</span>
<span class="token comment">// updates data already written to the file, creates new data to</span>
<span class="token comment">// be placed in the file, and deletes data previously in the file.</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token comment">// clientData structure definition</span>
<span class="token keyword">struct</span> clientData <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> acctNum<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">char</span> lastName<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// account last name</span>
  <span class="token keyword">char</span> firstName<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// account first name</span>
  <span class="token keyword">double</span> balance<span class="token punctuation">;</span>        <span class="token comment">// account balance</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                       <span class="token comment">// end structure clientData</span>

<span class="token comment">// prototypes</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">enterChoice</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">textFile</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>readPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">updateRecord</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">newRecord</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">deleteRecord</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  FILE <span class="token operator">*</span>cfPtr<span class="token punctuation">;</span>          <span class="token comment">// credit.dat file pointer</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> choice<span class="token punctuation">;</span>  <span class="token comment">// user's choice</span>

  <span class="token comment">// fopen opens the file; exits if file cannot be opened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cfPtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"credit.dat"</span><span class="token punctuation">,</span> <span class="token string">"rb+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// enable user to specify action</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>choice <span class="token operator">=</span> <span class="token function">enterChoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>choice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// create text file from record file</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
          <span class="token function">textFile</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">// update record</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
          <span class="token function">updateRecord</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">// create record</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
          <span class="token function">newRecord</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">// delete existing record</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
          <span class="token function">deleteRecord</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">// display message if user does not select valid choice</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
          <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Incorrect choice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>  <span class="token comment">// end switch</span>
    <span class="token punctuation">}</span>    <span class="token comment">// end while</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>cfPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes the file</span>
  <span class="token punctuation">}</span>                 <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end main</span>

<span class="token comment">// create formatted text file for printing</span>
<span class="token keyword">void</span> <span class="token function">textFile</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>readPtr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  FILE <span class="token operator">*</span>writePtr<span class="token punctuation">;</span>  <span class="token comment">// accounts.txt file pointer</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span>      <span class="token comment">// used to test whether fread read any bytes</span>

  <span class="token comment">// create clientData with default information</span>
  <span class="token keyword">struct</span> clientData client <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// fopen opens the file; exits if file cannot be opened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>writePtr <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"accounts.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"File could not be opened."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">rewind</span><span class="token punctuation">(</span>readPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// sets pointer to beginning of file</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>writePtr<span class="token punctuation">,</span> <span class="token string">"%-6s%-16s%-11s%10s\n"</span><span class="token punctuation">,</span> <span class="token string">"Acct"</span><span class="token punctuation">,</span> <span class="token string">"Last Name"</span><span class="token punctuation">,</span> <span class="token string">"First Name"</span><span class="token punctuation">,</span>
            <span class="token string">"Balance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// copy all records from random-access file into text file</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>readPtr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> readPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// write single record to text file</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> client<span class="token punctuation">.</span>acctNum <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>writePtr<span class="token punctuation">,</span> <span class="token string">"%-6d%-16s%-11s%10.2f\n"</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>acctNum<span class="token punctuation">,</span>
                client<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span> client<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span> client<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>  <span class="token comment">// end if</span>
    <span class="token punctuation">}</span>    <span class="token comment">// end while</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>writePtr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fclose closes the file</span>
  <span class="token punctuation">}</span>                    <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end function textFile</span>

<span class="token comment">// update balance in record</span>
<span class="token keyword">void</span> <span class="token function">updateRecord</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fPtr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> account<span class="token punctuation">;</span>  <span class="token comment">// account number</span>
  <span class="token keyword">double</span> transaction<span class="token punctuation">;</span>    <span class="token comment">// transaction amount</span>

  <span class="token comment">// create clientData with no information</span>
  <span class="token keyword">struct</span> clientData client <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// obtain number of account to update</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter account to update ( 1 - 100 ): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// move file pointer to correct record in file</span>
  <span class="token function">fseek</span><span class="token punctuation">(</span>fPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>account <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// read record from file</span>
  <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// display error if account does not exist</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>acctNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Account #%d has no information.\n"</span><span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>       <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// update record</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-6d%-16s%-11s%10.2f\n\n"</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>acctNum<span class="token punctuation">,</span> client<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span>
           client<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span> client<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// request transaction amount from user</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter charge ( + ) or payment ( - ): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>balance <span class="token operator">+</span><span class="token operator">=</span> transaction<span class="token punctuation">;</span>  <span class="token comment">// update record balance</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-6d%-16s%-11s%10.2f\n"</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>acctNum<span class="token punctuation">,</span> client<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span>
           client<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span> client<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// move file pointer to correct record in file</span>
    <span class="token function">fseek</span><span class="token punctuation">(</span>fPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>account <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// write updated record over old record in file</span>
    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end function updateRecord</span>

<span class="token comment">// delete an existing record</span>
<span class="token keyword">void</span> <span class="token function">deleteRecord</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fPtr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> clientData client<span class="token punctuation">;</span>  <span class="token comment">// stores record read from file</span>
  <span class="token keyword">struct</span> clientData blankClient <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// blank client</span>

  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> accountNum<span class="token punctuation">;</span>  <span class="token comment">// account number</span>

  <span class="token comment">// obtain number of account to delete</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter account number to delete ( 1 - 100 ): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>accountNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// move file pointer to correct record in file</span>
  <span class="token function">fseek</span><span class="token punctuation">(</span>fPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>accountNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// read record from file</span>
  <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// display error if record does not exist</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>acctNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Account %d does not exist.\n"</span><span class="token punctuation">,</span> accountNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>       <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// delete record</span>
    <span class="token comment">// move file pointer to correct record in file</span>
    <span class="token function">fseek</span><span class="token punctuation">(</span>fPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>accountNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// replace existing record with blank record</span>
    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>blankClient<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end function deleteRecord</span>

<span class="token comment">// create and insert record</span>
<span class="token keyword">void</span> <span class="token function">newRecord</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fPtr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// create clientData with default information</span>
  <span class="token keyword">struct</span> clientData client <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> accountNum<span class="token punctuation">;</span>  <span class="token comment">// account number</span>

  <span class="token comment">// obtain number of account to create</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter new account number ( 1 - 100 ): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>accountNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// move file pointer to correct record in file</span>
  <span class="token function">fseek</span><span class="token punctuation">(</span>fPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>accountNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// read record from file</span>
  <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// display error if account already exists</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>acctNum <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Account #%d already contains information.\n"</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>acctNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>       <span class="token comment">// end if</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// create record</span>
    <span class="token comment">// user enters last name, first name and balance</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"Enter lastname, firstname, balance\n? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%14s%9s%lf"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>client<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span> <span class="token operator">&amp;</span>client<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span> <span class="token operator">&amp;</span>client<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    client<span class="token punctuation">.</span>acctNum <span class="token operator">=</span> accountNum<span class="token punctuation">;</span>

    <span class="token comment">// move file pointer to correct record in file</span>
    <span class="token function">fseek</span><span class="token punctuation">(</span>fPtr<span class="token punctuation">,</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>acctNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// insert record in file</span>
    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> clientData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  <span class="token comment">// end else</span>
<span class="token punctuation">}</span>  <span class="token comment">// end function newRecord</span>

<span class="token comment">// enable user to input menu choice</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">enterChoice</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> menuChoice<span class="token punctuation">;</span>  <span class="token comment">// variable to store user's choice</span>

  <span class="token comment">// display available options</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>
         <span class="token string">"\nEnter your choice\n"</span>
         <span class="token string">"1 - store a formatted text file of accounts called\n"</span>
         <span class="token string">"    \"accounts.txt\" for printing\n"</span>
         <span class="token string">"2 - update an account\n"</span>
         <span class="token string">"3 - add a new account\n"</span>
         <span class="token string">"4 - delete an account\n"</span>
         <span class="token string">"5 - end program\n? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%u"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>menuChoice<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// receive choice from user</span>
  <span class="token keyword">return</span> menuChoice<span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// end function enterChoice</span>

</code></pre>
<h1 id="command-line-arguments">Command line arguments</h1>
<p><img src="https://files.gitter.im/kgashok/advik/jbXG/commandLineArgv.png" alt="command"></p>
<p>On many UNIX systems, it is possible to pass arguments to <strong><code>main</code></strong> from the command line by including the parameters <strong><code>int argc</code></strong> and <strong><code>char *argv[]</code></strong> in the parameter list of <strong><code>main()</code></strong>.</p>
<ul>
<li>
<p>Parameter <strong><code>argc</code></strong> receives the number of command-line arguments</p>
</li>
<li>
<p>Parameter <strong><code>argv</code></strong> is an array of strings in which the actual command-line arguments are stored</p>
</li>
<li>
<p>Common uses of command-line arguments include passing options to a program and passing filenames to a program.</p>
</li>
</ul>
<p>It is possible to pass arguments to <code>C</code> programs when they are executed. The brackets which follow <code>main()</code> are used for this purpose. <code>argc</code> refers to the number of arguments passed, and <code>argv[]</code> is a pointer array which points to each argument which is passed to <code>main</code>.</p>
<h2 id="simple-example">Simple example</h2>
<p>A simple example follows, which checks to see if a single argument is supplied on the command line when the program is invoked. The program is called by the command line,</p>
<pre><code> &gt; myprog argument1
</code></pre>
<p>The actual <code>C</code> code for the program is presented below:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The argument supplied is %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Too many arguments supplied.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"One argument expected.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Note that <code>*argv[0]</code> is the name of the program invoked, which means that <code>*argv[1]</code> is a pointer to the first argument supplied, and <code>*argv[n]</code> is the last argument. If no arguments are supplied, <code>argc</code> will be <code>1</code>. Thus for <code>n</code> arguments, <code>argc</code> will be equal to <code>n + 1</code>.</p>
<h2 id="another-example">Another example</h2>
<p>Review the <a href="https://github.com/kgisl/cs8251/blob/master/code/argsort.c">argument sorting program</a> to see how <code>argc</code> and <code>argv[]</code> are used to pass as arguments for <code>qsort</code> which sorts the input command line arguments.</p>
<h2 id="program-5.3">Program 5.3</h2>
<p><strong>Program 5.3</strong> below copies a file into another file one character at a time. We assume that the executable file for the program is called <strong>mycopy</strong>. A typical command line for the <strong>mycopy</strong> program on a Linux/UNIX system is</p>
<pre><code>&gt; `mycopy input output`  
</code></pre>
<ul>
<li>This command line indicates that file <strong>input</strong> is to be copied to file <strong>output</strong>. When the program is executed, if <strong>argc</strong> is not 3 (<strong>mycopy</strong> counts as one of the arguments), the program prints an error message and terminates. Otherwise, array <strong>argv</strong> contains the strings “mycopy”, “input” and “output”.</li>
<li>The second and third arguments on the command line are used as file names by the program. The files are opened using function <strong>fopen</strong>. If both files are opened successfully, characters are read from file <strong>input</strong> and written to file <strong>output</strong> until the <strong>end-of-file indicator</strong> for file input is set.</li>
<li>Then the program terminates. The result is an exact copy of file input (if no errors occur during processing).</li>
</ul>
<pre><code>// Using command-line arguments
#include &lt;stdio.h&gt;

int main(int argc, char *argv[]) {
  FILE *inFilePtr;   // input file pointer
  FILE *outFilePtr;  // output file pointer
  int c;             // define c to hold characters read from the source file

  // check number of command-line arguments
  if (argc != 3) {
    puts("Usage: mycopy infile outfile");
  }  // end if
  else {
    // if input file can be opened
    if ((inFilePtr = fopen(argv[1], "r")) != NULL) {
      // if output file can be opened
      if ((outFilePtr = fopen(argv[2], "w")) != NULL) {
        // read and output characters
        while ((c = fgetc(inFilePtr)) != EOF) {
          fputc(c, outFilePtr);
        }  // end while

        fclose(outFilePtr);  // close the output file
      }                      // end if
      else {                 // output file could not be opened
        printf("File \"%s\" could not be opened\n", argv[2]);
      }  // end else

      fclose(inFilePtr);  // close the input file
    }                     // end if
    else {                // input file could not be opened
      printf("File \"%s\" could not be opened\n", argv[1]);
    }  // end else
  }    // end else
}  // end main
 
</code></pre>
<p><em>Also refer to the test case <code>file_copy</code> in <a href="#solutiontestscpp">solutions.test.cpp</a></em></p>
<h3 id="count-bytes-in-a-file">Count bytes in a file</h3>
<p>Version 1 (using command line args)<br>
-  <a href="https://github.com/kgashok/filesOCR/blob/master/hand.c">https://github.com/kgashok/filesOCR/blob/master/hand.c</a></p>
<p>Version 2<br>
- test case <code>count_number_of_bytes_in_text_file</code> in <a href="#solutiontestscpp">solutions.test.cpp</a></p>
<h1 id="faq">FAQ</h1>
<p><strong>1. What is file?</strong><br>
A file is a collection of bytes stored on a secondary storage device, which<br>
is generally a disk of some kind. It is identified by a name, which is given<br>
at the time of its creation. It may be amended, moved from one storage<br>
device to another or removed completely when desired.</p>
<p><strong>2. What is a stream?</strong><br>
In C, the stream is a common, logical interface to the various devices<br>
that form the computer. When the program executes, each stream is<br>
tied together to a specifi c device that is source or destination of data.<br>
The stream provides a consistent interface and to the programmer one<br>
hardware device will look much like another. In its most common form,<br>
a stream is a logical interface to a fi le. Stream I/O uses some temporary<br>
storage area, called buffer, for reading from or writing data to a fi le.<br>
A stream is linked to a fi le by using an open operation. A stream is<br>
disassociated from a fi le using a close operation.<br>
The C language provides three “standard” streams that are always<br>
available to a C program. These are</p>
<pre><code>	Name   Description      Example
	stdin  Standard Input   Keyboard
	stdout Standard Output  Screen
	stderr Standard Error   Screen
</code></pre>
<p><strong>3. What is buffer? What’s its purpose?</strong><br>
Buffer is a temporary storage area that holds data while they are being<br>
transferred to and from memory. Buffering is a scheme that prevents<br>
excessive access to a physical I/O device like a disk or a terminal. Its<br>
purpose is to synchronize the physical devices that the program needs.<br>
The buffer collects output data until there are enough to write efficiently.<br>
The buffering activities are taken care of by software called device<br>
drivers or access methods provided by the operating system.</p>
<p><strong>4. Why have buffers?</strong><br>
It speeds up input/output which can be a major bottleneck in execution<br>
times. That is, it is less time-consuming to transmit several characters<br>
as a block than to send them one by one.</p>
<p><strong>5. What is <strong>FILE</strong>?</strong><br>
FILE is a structure declared in stdio.h. The members of the<br>
FILE structure are used by the program in the various fi le access<br>
operations. For each fi le that is to be opened, a pointer to type FILE<br>
must be declared. When the function fopen() is called, that function<br>
creates an instance of the FILE structure and returns a pointer to that<br>
structure. This pointer is used in all subsequent operations on the fi le.<br>
But programmers don’t need to be concerned about the members of the<br>
structure FILE.</p>
<p>Because one may use a number of different files in the program,<br>
he or she must specify when reading or writing which fi le one wishes<br>
to use. This is accomplished by using a variable called a file pointer, a<br>
pointer variable that points to a structure FILE.</p>
<p><strong>6. How many files can I open at once?</strong><br>
The number of fi les that can be opened at once will be determined by<br>
the value of the constant FOPEN_MAX that is defined in <code>&lt;stdio.h&gt;</code>.<br>
<code>FOPEN_MAX</code> is an integer that specifies the maximum number of streams<br>
that can be open at one time. The C language standard requires that<br>
the value of <code>FOPEN_MAX</code> be at least 8, including the standard streams<br>
<code>stdin</code>, <code>stdout</code> and <code>stderr</code>. Thus, as a minimum, it’s possible to<br>
work with up to 5 files simultaneously.</p>
<p>**7. What is the advantage of text files over binary files? **<br>
Due to differences in binary data representations across platforms, files written in binary format often are not portable. For more portable file representations, consider using text files.</p>
<h1 id="bonus-material">Bonus Material</h1>
<h3 id="modular-versions">Modular Versions</h3>
<p>Fork <a href="http://cyberdojo1.kgfsl.com/forker/fork/6EA156F740?avatar=hyena&amp;tag=-1">this CD session</a> to get testable code!</p>
<h4 id="read_from_stream_into_arrayconst-char-file-int">read_from_stream_into_array(const char*, FILE*, int[])</h4>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">// can also be easily extended and modified</span>
<span class="token comment">// will come handy for next refactoring</span>
<span class="token comment">//</span>
<span class="token keyword">int</span> <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> fname<span class="token punctuation">,</span>  <span class="token comment">// to use in logging if there is an error</span>
    FILE<span class="token operator">*</span> fp<span class="token punctuation">,</span>           <span class="token comment">// can also be assigned to stdin</span>
    <span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token comment">// array to be filled with values</span>
    <span class="token keyword">int</span> size            <span class="token comment">// will decide max num of entries to read</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Reading numbers from %s\n"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> counter <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fscanf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d "</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>array<span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d\n"</span><span class="token punctuation">,</span> counter<span class="token punctuation">,</span> array<span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Invalid file pointer for file:%s!"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> counter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<h4 id="calculate_sumint-arr-int-size">calculate_sum(int[] arr, int size)</h4>
<pre class=" language-c"><code class="prism  language-c"><span class="token keyword">float</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">=</span> sum <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Sum: %f\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

   
</code></pre>
<h4 id="modular-main">modular main()</h4>
<pre class=" language-c"><code class="prism  language-c">
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> fp<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> i<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The average is %f for %d numbers\n"</span><span class="token punctuation">,</span> average<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No data available in num.dat!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<h2 id="averaging-entries-from-stdin">Averaging entries from stdin</h2>
<pre class=" language-c"><code class="prism  language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token string">"stdin"</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> i<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The average is %f for %d numbers\n"</span><span class="token punctuation">,</span> average<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No data available on stdin!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="example-program-average-of-numbers">Example Program: Average of numbers</h2>
<p>Write a program to calculate the average of first n numbers. This is the simplest version of calculating averages of a bunch of numbers.</p>
<pre class=" language-c"><code class="prism  language-c">
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> n<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sum <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> avg <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n Enter the value of n : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span><span class="token punctuation">{</span>
        sum <span class="token operator">=</span> sum <span class="token operator">+</span> i<span class="token punctuation">;</span>
        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    avg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>sum<span class="token operator">/</span>n<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n The sum of first %d numbers = %d"</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n The average of first %d numbers = %.2f"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> avg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Output</strong></p>
<pre><code>Enter the value of n : 20
The sum of first 20 numbers = 210
The average of first 20 numbers = 10.05
</code></pre>
<h2 id="using-9999-as-eof">Using ‘9999’ as EOF</h2>
<p>The next program reads five integer values from the keyboard and stores them in the data file <code>num.dat</code>. In this program the user-defined character is used, as end-of-file marker instead of standard <code>EOF</code>.</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter 5 numbers, to be stored in num.dat..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unable to open num.dat...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Output:</strong></p>
<pre><code>Enter 5 numbers, to be stored in num.dat ... 1 2 3 4 5
</code></pre>
<h3 id="solution.h">solution.h</h3>
<pre class=" language-c"><code class="prism  language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> SOLUTION_INCLUDED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> SOLUTION_INCLUDED</span>

<span class="token keyword">int</span>   <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">,</span> FILE <span class="token operator">*</span>f<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">int</span>   <span class="token function">write_to_stream_from_array</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">,</span> FILE <span class="token operator">*</span>f<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span>   <span class="token function">filesize</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>   <span class="token function">filecopy</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> source<span class="token punctuation">,</span> FILE<span class="token operator">*</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>   <span class="token function">fileappend</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> source<span class="token punctuation">,</span> FILE<span class="token operator">*</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>   <span class="token function">fileprint</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre>
<h3 id="solution.c">solution.c</h3>
<pre class=" language-c"><code class="prism  language-c">
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"solution.h"</span></span>

<span class="token keyword">int</span> <span class="token function">filesize</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> fp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">fseek</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span>count<span class="token punctuation">)</span>
            <span class="token punctuation">;</span>

        <span class="token function">rewind</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">filecopy</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> source<span class="token punctuation">,</span> FILE<span class="token operator">*</span> dest<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> dest <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span>count<span class="token punctuation">)</span>
            <span class="token function">fputc</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">rewind</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rewind</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">fileappend</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> source<span class="token punctuation">,</span> FILE<span class="token operator">*</span> dest<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">fseek</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count <span class="token operator">=</span> <span class="token function">filecopy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">fileprint</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> fp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">fseek</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span>count<span class="token punctuation">)</span>
            <span class="token function">putc</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// can also be easily extended and modified</span>
<span class="token comment">// will come handy for next refactoring</span>
<span class="token comment">//</span>
<span class="token keyword">int</span> <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> fname<span class="token punctuation">,</span> <span class="token comment">// to use in logging if there is an error</span>
    FILE<span class="token operator">*</span> fp<span class="token punctuation">,</span> <span class="token comment">// can also be assigned to stdin</span>
    <span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// array to be filled with values</span>
    <span class="token keyword">int</span> size <span class="token comment">// will decide max num of entries to read</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Reading numbers from %s\n"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> counter <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fscanf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d "</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>array<span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d\n"</span><span class="token punctuation">,</span> counter<span class="token punctuation">,</span> array<span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            counter<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Invalid file pointer for file:%s!"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> counter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">write_to_stream_from_array</span><span class="token punctuation">(</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> fname<span class="token punctuation">,</span>
    FILE<span class="token operator">*</span> fp<span class="token punctuation">,</span>
    <span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">int</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d\n"</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            index<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Invalid file pointer for file:%s!"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> index<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// Calculate the sum but pays attention to only</span>
<span class="token comment">// the number of entries made into the array</span>
<span class="token comment">//</span>
<span class="token keyword">float</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">=</span> sum <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Sum: %f\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>
<h3 id="solution.tests.cpp">solution.tests.cpp</h3>
<pre class=" language-c"><code class="prism  language-c">
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;gtest/gtest.h&gt;</span></span>

<span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"solution.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"_utils.h"</span></span>
<span class="token punctuation">}</span>

using namespace <span class="token punctuation">:</span><span class="token punctuation">:</span>testing<span class="token punctuation">;</span>


<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> read_from_two_files_and_merge_to_third_file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FILE <span class="token operator">*</span>fp1<span class="token punctuation">,</span> <span class="token operator">*</span>fp2<span class="token punctuation">,</span> <span class="token operator">*</span>fp3<span class="token punctuation">;</span>
    fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"first.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"second.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp3 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file3.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">filecopy</span><span class="token punctuation">(</span>fp1<span class="token punctuation">,</span> fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fileappend</span><span class="token punctuation">(</span>fp2<span class="token punctuation">,</span> fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// how do you know it worked?</span>
    <span class="token keyword">int</span> size1<span class="token punctuation">,</span> size2<span class="token punctuation">,</span> size3<span class="token punctuation">;</span>
    size1 <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size2 <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size3 <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>size1 <span class="token operator">+</span> size2<span class="token punctuation">,</span> size3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// validation count-wise</span>

    <span class="token comment">// validate it visually as well!</span>
    <span class="token function">fileprint</span><span class="token punctuation">(</span>fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> read_from_stdin_and_append_to_existing_file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// normally not required</span>
    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"num.txt"</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    FILE<span class="token operator">*</span> fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file2.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> before <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fileappend</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> fp1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// contents from stdin &gt;&gt; file2</span>
    <span class="token keyword">int</span> after <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"before %d , after %d\n"</span><span class="token punctuation">,</span> before<span class="token punctuation">,</span> after<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> file_append<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FILE <span class="token operator">*</span>fp1<span class="token punctuation">,</span> <span class="token operator">*</span>fp2<span class="token punctuation">;</span>
    fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file1.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file2.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp1 <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> fp2 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">filecopy</span><span class="token punctuation">(</span>fp1<span class="token punctuation">,</span> fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fileappend</span><span class="token punctuation">(</span>fp1<span class="token punctuation">,</span> fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count2 <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token function">ASSERT_FALSE</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> file_copy<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FILE <span class="token operator">*</span>fp1<span class="token punctuation">,</span> <span class="token operator">*</span>fp2<span class="token punctuation">;</span>
    fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file1.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file2.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp1 <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> fp2 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">filecopy</span><span class="token punctuation">(</span>fp1<span class="token punctuation">,</span> fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count2 <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">ASSERT_FALSE</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    count <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"num.txt"</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file2.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">filecopy</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    count2 <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> get_from_stdin_and_calculate_average<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"num.txt"</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token string">"stdin"</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> i<span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The average is %f for %d numbers\n"</span><span class="token punctuation">,</span>
            average<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_FLOAT_EQ</span><span class="token punctuation">(</span>average<span class="token punctuation">,</span> <span class="token number">667.333313</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No data available in num.txt!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> read_from_two_files_and_sum_into_third_file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FILE <span class="token operator">*</span>fp1<span class="token punctuation">,</span> <span class="token operator">*</span>fp2<span class="token punctuation">,</span> <span class="token operator">*</span>fp3<span class="token punctuation">;</span>
    fp1 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"stat1.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp2 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"stat2.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fp3 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"star3.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> arr1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr2<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr3<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token string">"stat1.txt"</span><span class="token punctuation">,</span> fp1<span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token string">"stat2.txt"</span><span class="token punctuation">,</span> fp2<span class="token punctuation">,</span> arr2<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"array 1\n"</span><span class="token punctuation">,</span> fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write_to_stream_from_array</span><span class="token punctuation">(</span><span class="token string">"stat3.txt"</span><span class="token punctuation">,</span> fp3<span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"array 2\n"</span><span class="token punctuation">,</span> fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write_to_stream_from_array</span><span class="token punctuation">(</span><span class="token string">"stat3.txt"</span><span class="token punctuation">,</span> fp3<span class="token punctuation">,</span> arr2<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"The Sum!\n"</span><span class="token punctuation">,</span> fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write_to_stream_from_array</span><span class="token punctuation">(</span><span class="token string">"stat3.txt"</span><span class="token punctuation">,</span> fp3<span class="token punctuation">,</span> arr3<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fileprint</span><span class="token punctuation">(</span>fp3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// should print '6 6 6 6 6'</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>fp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> count_number_of_bytes_in_text_file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"podcast.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"File is not available!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span>count<span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Number of bytes: %d\n"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">3667</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> DISABLED_get_from_stdin_and_store_values_in_file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"num.txt"</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter 5 numbers, to be stored in num.dat..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//fprintf(fp,"%d", 9999);</span>
        <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unable to open num.dat...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> calculate_average_of_numbers_in_file_using_functions<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">read_from_stream_into_array</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> fp<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token function">calculate_sum</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> i<span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The average is %f for %d numbers\n"</span><span class="token punctuation">,</span>
            average<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>average<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No data available in num.dat!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// verbose yet simple, non-functional version</span>
<span class="token function">TEST</span><span class="token punctuation">(</span>FileTest<span class="token punctuation">,</span> calculate_average_of_numbers_stored_in_file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FILE<span class="token operator">*</span> fp<span class="token punctuation">;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"num.dat"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Reading numbers from num.dat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fscanf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">"%d "</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sum <span class="token operator">+</span><span class="token operator">=</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">float</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> i<span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The average is %f for %d numbers\n"</span><span class="token punctuation">,</span>
                average<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No data available in num.dat!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unable to open num.dat...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>

    </div>
  </div>
</body>

</html>
